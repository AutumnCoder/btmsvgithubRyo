<!DOCTYPE html>
<html>
<head>
    <title>My Website (Multi-Product Cart)</title>
    <style>
        body { font-family: Arial; text-align: center; margin-top: 50px; }
        button { padding: 10px 20px; font-size: 16px; margin: 10px 5px; }
        input, select { padding: 10px; margin-top: 10px; width: 220px; }
        img { margin-top: 20px; }
    </style>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.814.0.min.js"></script>
</head>
<body>
    <h1 id="title">Login with Gmail(THIS IS A FAKE WEBSITE I MADE FOR A PROJECT,IF YOU ACCESSED THIS PLEASE IGNORE)</h1>
    <input type="email" id="email" placeholder="Enter your Gmail" /><br>
    <input type="email" id="confirm-email" placeholder="Retype your Gmail" /><br>
    <button onclick="login()">Login</button>

    <div id="main-content" style="display:none;">
        <p id="message">Welcome! Please select products:</p>
        <select id="product-select">
            <option value="">-- Select a product --</option>
            <option value="ESP32">ESP32</option>
            <option value="ESP32-S1">ESP32-S1</option>
            <option value="ESP32-S2">ESP32-S2</option>
            <option value="ESP32-S3">ESP32-S3</option>
        </select><br>
        <button onclick="addToCart()">Add to Cart</button>
        <button onclick="checkout()">Checkout</button>
        <button onclick="goBack()">Clear Cart</button>
        <div id="cart" style="margin-top:20px;"></div>
        <div id="checkout" style="display:none;">
            <img src="https://via.placeholder.com/150" alt="QR Code for Payment" /><br>
            <p>Your receipt number is: <strong id="receipt-number"></strong></p>
            <p>If cannot pay, please Paylah to this number: <strong>#65 123456789</strong></p>
        </div>
        <p id="timestamp" style="margin-top:20px; font-weight:bold;"></p>
    </div>

    <script>
        AWS.config.update({
            accessKeyId: 'AKIAWOAVSFXCDM7PY3BH',
            secretAccessKey: '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',
            region: 'ap-southeast-1'
        });

        const docClient = new AWS.DynamoDB();
        let userEmail = '';
        let cart = [];

        function login() {
            const email = document.getElementById('email').value;
            const confirmEmail = document.getElementById('confirm-email').value;

            if (!email || !email.includes('@gmail.com')) {
                alert('Please enter a valid Gmail address.');
                return;
            }

            if (email !== confirmEmail) {
                alert('The emails do not match. Please retype them correctly.');
                return;
            }

            userEmail = email;
            document.getElementById('title').innerText = 'Hello, ' + userEmail;
            document.getElementById('main-content').style.display = 'block';
            document.getElementById('email').style.display = 'none';
            document.getElementById('confirm-email').style.display = 'none';
            document.querySelector('button[onclick="login()"]').style.display = 'none';
        }

        function addToCart() {
            const productSelect = document.getElementById('product-select');
            const product = productSelect.value;

            if (!product) {
                alert('Please select a product before adding to cart.');
                return;
            }

            if (!cart.includes(product)) {
                cart.push(product);
            }

            updateCartDisplay();
        }

        function updateCartDisplay() {
            const cartDiv = document.getElementById('cart');
            cartDiv.innerHTML = '<strong>Cart:</strong> ' + cart.join(', ');
        }

        function checkout() {
            if (cart.length === 0) {
                alert('Your cart is empty.');
                return;
            }

            const receiptNumber = 'ORDER' + Math.floor(100000 + Math.random() * 900000);
            const timestamp = Date.now().toString();

            const params = {
                TableName: 'web_app',
                Item: {
                    id: { S: receiptNumber },
                    products: { SS: cart },
                    user: { S: userEmail },
                    timestamp: { N: timestamp }
                }
            };

            docClient.putItem(params, function(err, data) {
                if (err) {
                    console.error('Error saving order:', JSON.stringify(err, null, 2));
                } else {
                    console.log('Order saved:', JSON.stringify(data, null, 2));
                }
            });

            document.getElementById('message').innerText = 'Thank you! Your order is complete. Please scan the QR code below to pay.';
            document.getElementById('receipt-number').innerText = receiptNumber;
            document.getElementById('checkout').style.display = 'block';
            document.getElementById('timestamp').innerText = 'Completed at: ' + new Date(parseInt(timestamp)).toLocaleString();

            // Disable further actions
            document.getElementById('product-select').disabled = true;
        }

        function goBack() {
            cart = [];
            updateCartDisplay();
            document.getElementById('message').innerText = 'Welcome! Please select products:';
            document.getElementById('checkout').style.display = 'none';
            document.getElementById('product-select').disabled = false;
            document.getElementById('timestamp').innerText = '';
        }
    </script>
</body>
</html>

