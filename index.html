<!DOCTYPE html>
<html>
<head>
  <title>Firebase Chat Demo</title>
  <meta name="viewport" content="width=400">
  <style>
    body { font-family: sans-serif; max-width: 400px; margin: 40px auto; }
    #messages { border: 1px solid #ccc; height: 230px; overflow-y: auto; margin-bottom: 12px; padding: 8px; }
    #chat { display: none; }
    #login { margin-bottom: 20px; }
    .msg { margin: 4px 0; }
    .me { color: green; font-weight: bold; }
    .other { color: blue; }
    #msg { width: 72%; font-size: 16px; }
    #sendBtn, #clearBtn { font-size: 16px; }
  </style>
  <!-- Firebase JS SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  <h2>Firebase Chat Demo</h2>
  <div id="login">
    <label>Enter your username:</label>
    <input type="text" id="usernameInput" placeholder="Any name" />
    <button onclick="login()">Join Chat</button>
  </div>
  <div id="chat">
    <div><b>Logged in as:</b> <span id="currentUser"></span></div>
    <div id="messages"></div>
    <input id="msg" type="text" placeholder="Type your message" autocomplete="off" />
    <button id="sendBtn" onclick="send()">Send</button>
    <button id="clearBtn" onclick="clearChat()">Clear Chat</button>
  </div>
  <script>
    // Your Firebase config (from your message)
    const firebaseConfig = {
      apiKey: "AIzaSyAN1I2hHsOB3nkA_JOHbdBw0lvV1wuYSo0",
      authDomain: "my-chat-demo-6dfb3.firebaseapp.com",
      databaseURL: "https://my-chat-demo-6dfb3-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "my-chat-demo-6dfb3",
      storageBucket: "my-chat-demo-6dfb3.firebasestorage.app",
      messagingSenderId: "507245313126",
      appId: "1:507245313126:web:138e765dabe43e5c7741a7"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let username = "";
    const chatRef = db.ref("chatmessages");

    function login() {
      const uname = document.getElementById('usernameInput').value.trim();
      if (!uname) {
        alert("Please enter a username!");
        return;
      }
      username = uname;
      document.getElementById('login').style.display = 'none';
      document.getElementById('chat').style.display = 'block';
      document.getElementById('currentUser').textContent = username;
      document.getElementById('msg').focus();
    }

    function send() {
      const msgInput = document.getElementById('msg');
      const msg = msgInput.value.trim();
      if (!msg) return;
      chatRef.push({
        sender: username,
        text: msg,
        time: Date.now()
      });
      msgInput.value = '';
      msgInput.focus();
    }

    function clearChat() {
      if (confirm("Clear all messages?")) {
        chatRef.remove();
      }
    }

    // Real-time listener for messages
    chatRef.limitToLast(50).on('value', snapshot => {
      const messagesDiv = document.getElementById('messages');
      messagesDiv.innerHTML = "";
      const data = snapshot.val();
      if (!data) return;
      Object.values(data).forEach(m => {
        let className = m.sender === username ? 'me' : 'other';
        messagesDiv.innerHTML += `<div class="msg ${className}">${m.sender}: ${m.text}</div>`;
      });
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });

    // Send with Enter key
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('msg').addEventListener('keydown', function(e) {
        if (e.key === 'Enter') send();
      });
    });
  </script>
</body>
</html>
